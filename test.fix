module Test;

import EZS::{cd, cwd, run_o, run_wi_o, Context::default};
import Std::{IO, Debug::{assert, assert_eq}, IO::println, Monad::pure, String::ends_with};

test : IO ();
test = (
    // Run "grep \"ERROR\"" with run_wi_o, and stream the input "[E]ERROR\n[I]INFO\n[D]DEBUG\n" to it.
    let ctx = EZS::Context::default;
    let input = "[E]ERROR\n[I]INFO\n[D]DEBUG\n";
    let stdout = *ctx.run_wi_o(["grep", "ERROR"], input);
    assert_eq(|_|"1", stdout, "[E]ERROR\n");;

    // Create directory "test_dir" and change to it.
    let dir_name = "test_dir";
    ctx.run_o(["mkdir", "-p", dir_name]);;
    ctx.cd(dir_name);;
    // Get current working directory and check if it ends with "test_dir".
    let cwd = *ctx.cwd;
    assert(|_|"", cwd.ends_with(dir_name));;
    ctx.cd("..");;

    pure()
);